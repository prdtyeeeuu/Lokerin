<%- include('partials/header', { title: 'Dashboard' }) %>
<%- include('partials/auth-forms') %>

<div id="app-layout" class="flex flex-col min-h-screen">
    <%- include('partials/nav') %>

    <main id="main-content" class="flex-1 pt-16 sm:pt-20 px-4 pb-8 overflow-y-auto">
        <div id="view-dashboard" class="view-section max-w-6xl mx-auto fade-in">
            <div class="mb-8 flex flex-col sm:flex-row justify-between items-start sm:items-end gap-4">
                <div>
                    <h2 class="text-2xl font-bold text-white">Halo, <span id="dash-username">User</span></h2>
                    <p class="text-slate-400">Status kelengkapan profil Anda.</p>
                </div>
                <div id="notification-area" class="hidden relative">
                    <button onclick="openModal('modal-requests')" class="p-2 bg-slate-800 rounded-full relative hover:bg-slate-700 transition">
                        <i class="fa-regular fa-bell text-white"></i>
                        <span id="notif-badge" class="absolute top-0 right-0 w-3 h-3 bg-red-500 rounded-full border border-slate-900 hidden"></span>
                    </button>
                </div>
            </div>

            <div class="grid grid-cols-1 gap-6 mb-8">
                <!-- COMPLETENESS CARD -->
                <div class="glass-card p-6 rounded-2xl">
                    <div class="flex justify-between items-center mb-2">
                        <div class="text-slate-400 text-sm font-medium">Kelengkapan Profil</div>
                        <div class="text-2xl font-bold text-emerald-400" id="dash-completeness">0%</div>
                    </div>
                    <div class="w-full bg-slate-700 rounded-full h-2.5 mb-3">
                        <div id="dash-progress" class="bg-emerald-500 h-2.5 rounded-full transition-all duration-500" style="width: 0%"></div>
                    </div>
                    <div id="dash-missing-container" class="hidden p-3 bg-yellow-500/10 border border-yellow-500/20 rounded-lg">
                        <p class="text-xs text-yellow-200 font-bold mb-1"><i class="fa-solid fa-triangle-exclamation mr-1"></i> Profil Belum Lengkap</p>
                        <p class="text-xs text-slate-400" id="dash-missing-text">Anda belum mengisi: Foto, Bio, dll.</p>
                    </div>
                </div>
                <div class="glass-card p-6 rounded-2xl">
                    <div class="text-slate-400 text-sm mb-1">Akses Profil Dilihat</div>
                    <div class="text-3xl font-bold text-indigo-400" id="dash-views">0</div>
                </div>
            </div>
        </div>

        <!-- Profile View -->
        <div id="view-profile" class="view-section hidden max-w-5xl mx-auto fade-in">
            <div class="glass-card rounded-2xl overflow-hidden mb-8 relative">
                <div class="h-32 bg-gradient-to-r from-indigo-900 to-purple-900 w-full"></div>
                <div class="px-4 sm:px-8 pb-8 flex flex-col items-center sm:flex-row gap-6 -mt-12 sm:-mt-16">
                    <div class="relative group">
                        <div class="w-32 h-32 rounded-full bg-slate-800 border-4 border-slate-900 overflow-hidden shadow-xl">
                            <img id="profile-avatar-display" src="" class="w-full h-full object-cover" loading="lazy">
                        </div>
                        <label for="avatar-upload" class="absolute bottom-2 right-2 bg-indigo-600 hover:bg-indigo-500 p-2 rounded-full text-white shadow-lg cursor-pointer">
                            <i class="fa-solid fa-camera text-xs"></i>
                        </label>
                        <input type="file" id="avatar-upload" accept="image/*" class="hidden" onchange="handleAvatarUpload(this)">
                    </div>
                    <div class="flex-1 mt-4 text-center sm:text-left">
                        <div class="flex flex-col sm:flex-row justify-between items-center gap-4">
                            <div>
                                <h1 class="text-2xl sm:text-3xl font-bold text-white" id="profile-name-display">Nama</h1>
                                <p class="text-indigo-400 font-medium flex flex-col sm:flex-row items-center gap-2" id="profile-role-display">
                                    <span>Role</span>
                                    <span id="profile-company-display" class="text-slate-400 text-sm font-normal bg-slate-800 px-2 py-0.5 rounded"></span>
                                </p>
                            </div>
                            <button onclick="openModal('modal-edit-profile')" class="mt-2 sm:mt-0 px-4 py-2 bg-slate-700 hover:bg-slate-600 border border-slate-600 rounded-lg text-sm font-medium text-white">
                                <i class="fa-solid fa-pen mr-2"></i> Edit
                            </button>
                        </div>
                        <p class="text-slate-300 mt-4 text-sm" id="profile-bio-display"></p>
                        <div class="flex flex-wrap justify-center sm:justify-start gap-2 mt-4" id="profile-skills-display"></div>
                    </div>
                </div>
            </div>

            <div class="flex flex-col sm:flex-row justify-between items-center mb-6 gap-4">
                <h2 class="text-xl font-bold text-white">Bukti Kerja & Portfolio</h2>
                <button onclick="openModal('modal-add-evidence')" class="px-4 py-2 bg-indigo-600 hover:bg-indigo-500 text-white text-sm font-medium rounded-lg shadow-lg shadow-indigo-600/20 w-full sm:w-auto text-center">
                    + Tambah Project
                </button>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="portfolio-grid"></div>
        </div>

        <!-- HRD Dashboard View -->
        <div id="view-hrd-dashboard" class="view-section hidden max-w-6xl mx-auto fade-in">
            <div class="mb-8">
                <h2 class="text-2xl font-bold text-white">Dashboard HRD</h2>
                <p class="text-slate-400">Kelola lowongan dan pelamar Anda.</p>
            </div>
            <div id="hrd-dashboard-content" class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <div class="glass-card p-6 rounded-2xl">
                    <div class="text-slate-400 text-sm mb-1">Total Lowongan</div>
                    <div class="text-3xl font-bold text-indigo-400" id="hrd-total-jobs">0</div>
                </div>
                <div class="glass-card p-6 rounded-2xl">
                    <div class="text-slate-400 text-sm mb-1">Total Pelamar</div>
                    <div class="text-3xl font-bold text-emerald-400" id="hrd-total-applicants">0</div>
                </div>
                <div class="glass-card p-6 rounded-2xl">
                    <div class="text-slate-400 text-sm mb-1">Menunggu Review</div>
                    <div class="text-3xl font-bold text-yellow-400" id="hrd-pending-review">0</div>
                </div>
            </div>
        </div>

        <!-- HRD Create Job View -->
        <div id="view-hrd-create-job" class="view-section hidden max-w-3xl mx-auto fade-in">
            <div class="mb-8">
                <h2 class="text-2xl font-bold text-white">Buat Lowongan Pekerjaan Baru</h2>
                <p class="text-slate-400">Publikasikan lowongan pekerjaan untuk menarik kandidat terbaik.</p>
            </div>
            <div class="glass-card p-6 rounded-2xl">
                <form id="create-job-form">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                        <div>
                            <label class="text-xs text-slate-400 block mb-1">Judul Pekerjaan *</label>
                            <input type="text" id="job-title" required class="w-full input-dark rounded p-2 text-sm" placeholder="Contoh: Software Engineer">
                        </div>
                        <div>
                            <label class="text-xs text-slate-400 block mb-1">Lokasi</label>
                            <input type="text" id="job-location" class="w-full input-dark rounded p-2 text-sm" placeholder="Contoh: Jakarta">
                        </div>
                    </div>

                    <div class="mb-6">
                        <label class="text-xs text-slate-400 block mb-1">Deskripsi Pekerjaan *</label>
                        <textarea id="job-description" rows="5" required class="w-full input-dark rounded p-2 text-sm" placeholder="Deskripsikan pekerjaan dan tanggung jawabnya..."></textarea>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                        <div>
                            <label class="text-xs text-slate-400 block mb-1">Gaji Minimum</label>
                            <input type="number" id="salary-min" class="w-full input-dark rounded p-2 text-sm" placeholder="Rp">
                        </div>
                        <div>
                            <label class="text-xs text-slate-400 block mb-1">Gaji Maksimum</label>
                            <input type="number" id="salary-max" class="w-full input-dark rounded p-2 text-sm" placeholder="Rp">
                        </div>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
                        <div>
                            <label class="text-xs text-slate-400 block mb-1">Tipe Pekerjaan</label>
                            <select id="job-type" class="w-full input-dark rounded p-2 text-sm">
                                <option value="">Pilih Tipe</option>
                                <option value="fulltime">Full Time</option>
                                <option value="parttime">Part Time</option>
                                <option value="contract">Kontrak</option>
                                <option value="internship">Magang</option>
                            </select>
                        </div>
                        <div>
                            <label class="text-xs text-slate-400 block mb-1">Level Pengalaman</label>
                            <select id="experience-level" class="w-full input-dark rounded p-2 text-sm">
                                <option value="">Pilih Level</option>
                                <option value="entry">Pemula (Entry)</option>
                                <option value="mid">Menengah (Mid)</option>
                                <option value="senior">Senior</option>
                                <option value="executive">Eksekutif</option>
                            </select>
                        </div>
                    </div>

                    <button type="submit" class="w-full py-3 bg-indigo-600 hover:bg-indigo-500 text-white font-bold rounded-lg transition-all">
                        Publikasikan Lowongan
                    </button>
                </form>
            </div>
        </div>

        <!-- HRD My Jobs View -->
        <div id="view-hrd-my-jobs" class="view-section hidden max-w-7xl mx-auto fade-in">
            <div class="mb-8 flex justify-between items-center">
                <div>
                    <h2 class="text-2xl font-bold text-white">Lowongan Saya</h2>
                    <p class="text-slate-400">Daftar lowongan yang telah Anda publikasikan.</p>
                </div>
                <button onclick="router.navigate('hrd-create-job')" class="px-4 py-2 bg-indigo-600 hover:bg-indigo-500 text-white text-sm font-medium rounded-lg shadow-lg shadow-indigo-600/20">
                    + Buat Lowongan Baru
                </button>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="job-postings-container"></div>
        </div>

        <!-- HRD Applications View -->
        <div id="view-hrd-applications" class="view-section hidden max-w-7xl mx-auto fade-in">
            <div class="mb-8">
                <h2 class="text-2xl font-bold text-white">Lamaran Pekerjaan</h2>
                <p class="text-slate-400">Daftar lamaran untuk lowongan yang Anda posting.</p>
            </div>
            <div class="overflow-x-auto">
                <table class="min-w-full bg-slate-800/50 rounded-xl overflow-hidden">
                    <thead class="bg-slate-700">
                        <tr>
                            <th class="py-3 px-4 text-left text-sm font-medium text-slate-300">Pelamar</th>
                            <th class="py-3 px-4 text-left text-sm font-medium text-slate-300">Posisi</th>
                            <th class="py-3 px-4 text-left text-sm font-medium text-slate-300">Tanggal Lamar</th>
                            <th class="py-3 px-4 text-left text-sm font-medium text-slate-300">Status</th>
                            <th class="py-3 px-4 text-left text-sm font-medium text-slate-300">Aksi</th>
                        </tr>
                    </thead>
                    <tbody class="divide-y divide-slate-700" id="job-applications-container"></tbody>
                </table>
            </div>
        </div>

        <!-- User Dashboard View -->
        <div id="view-user-dashboard" class="view-section hidden max-w-6xl mx-auto fade-in">
            <div class="mb-8">
                <h2 class="text-2xl font-bold text-white">Dashboard</h2>
                <p class="text-slate-400">Kelola karir dan lamaran Anda.</p>
            </div>
            <div id="user-dashboard-content" class="grid grid-cols-1 gap-6"></div>
        </div>

        <!-- User Jobs View -->
        <div id="view-user-jobs" class="view-section hidden max-w-7xl mx-auto fade-in">
            <div class="mb-8">
                <h2 class="text-2xl font-bold text-white">Cari Pekerjaan</h2>
                <p class="text-slate-400">Temukan pekerjaan impian Anda dari ribuan lowongan.</p>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="user-jobs-content"></div>
        </div>

        <!-- User Applications View -->
        <div id="view-user-applications" class="view-section hidden max-w-7xl mx-auto fade-in">
            <div class="mb-8">
                <h2 class="text-2xl font-bold text-white">Lamaran Saya</h2>
                <p class="text-slate-400">Pantau status lamaran pekerjaan Anda.</p>
            </div>
            <div class="overflow-x-auto">
                <table class="min-w-full bg-slate-800/50 rounded-xl overflow-hidden">
                    <thead class="bg-slate-700">
                        <tr>
                            <th class="py-3 px-4 text-left text-sm font-medium text-slate-300">Posisi</th>
                            <th class="py-3 px-4 text-left text-sm font-medium text-slate-300">Perusahaan</th>
                            <th class="py-3 px-4 text-left text-sm font-medium text-slate-300">Tanggal Lamar</th>
                            <th class="py-3 px-4 text-left text-sm font-medium text-slate-300">Status</th>
                        </tr>
                    </thead>
                    <tbody class="divide-y divide-slate-700" id="user-applications-content"></tbody>
                </table>
            </div>
        </div>
    </main>
</div>

<%- include('partials/modals') %>
<%- include('partials/footer') %>
